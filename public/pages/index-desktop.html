<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>TEK Intra | Staff Network</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js"></script>
    
    <style>
        :root { 
            --bg-dark: #050505;
            --accent-blue: rgba(59, 130, 246, 0.25);
            --accent-red: rgba(239, 68, 68, 0.15);
        }
        
        body { background-color: var(--bg-dark); color: #ffffff; font-family: 'Inter', sans-serif; overflow-x: hidden; min-height: 100vh; }

        /* Smooth Page Transitions */
        .page-view { 
            display: none; 
            opacity: 0; 
            transform: translateY(20px) scale(0.98);
            filter: blur(10px);
            transition: all 0.7s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .active-view { 
            display: block; 
            opacity: 1; 
            transform: translateY(0) scale(1);
            filter: blur(0px);
        }

        .view-exit {
            opacity: 0 !important;
            transform: translateY(-20px) scale(1.02) !important;
            filter: blur(15px) !important;
        }

        /* Nav Animations */
        .nav-link { position: relative; font-size: 0.65rem; color: #71717a; font-weight: 800; text-transform: uppercase; letter-spacing: 0.15em; transition: 0.3s; }
        .nav-link::after {
            content: ''; position: absolute; bottom: -8px; left: 50%; width: 0%; height: 2px;
            background: #fff; transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1); transform: translateX(-50%);
        }
        .nav-link.active::after { width: 100%; }
        .nav-link.active, .nav-link:hover { color: #fff; }

        /* Dynamic Background */
        .graphic-glow {
            position: fixed; top: 0; right: 0; width: 100vw; height: 100vh; z-index: -1;
            background: 
                radial-gradient(circle at 80% 20%, var(--accent-blue) 0%, transparent 50%),
                radial-gradient(circle at 20% 80%, var(--accent-red) 0%, transparent 50%);
            filter: blur(100px); opacity: 0.4; pointer-events: none;
            transition: transform 1.2s ease;
        }

        .glow-pulse { animation: glowPulse 0.8s ease-in-out; }
        @keyframes glowPulse {
            0% { transform: scale(1); opacity: 0.4; }
            50% { transform: scale(1.1); opacity: 0.7; }
            100% { transform: scale(1); opacity: 0.4; }
        }

        /* Card Effects */
        .sirius-card { 
            background: rgba(255, 255, 255, 0.02); backdrop-filter: blur(20px); 
            border: 1px solid rgba(255, 255, 255, 0.05); transition: all 0.5s ease;
        }
        .sirius-card:hover { border-color: rgba(255, 255, 255, 0.2); transform: translateY(-8px); background: rgba(255, 255, 255, 0.05); }

        .reveal { opacity: 0; transform: translateY(30px); transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1); }
        .reveal.visible { opacity: 1; transform: translateY(0); }

        /* Earth Rotation */
        .earth-container {
            width: 44px; height: 44px; border-radius: 50%; overflow: hidden;
            box-shadow: inset -5px -5px 15px rgba(0,0,0,0.8), 0 0 20px rgba(59, 130, 246, 0.3);
            background: url('https://upload.wikimedia.org/wikipedia/commons/thumb/c/c4/Earth_map_light_600x300.jpg/600px-Earth_map_light_600x300.jpg');
            background-size: cover; animation: rotateEarth 15s linear infinite; margin-bottom: 2rem;
        }
        @keyframes rotateEarth { from { background-position: 0 0; } to { background-position: 200% 0; } }

        ::-webkit-scrollbar { width: 0px; }
    </style>
</head>
<body>
    <div class="graphic-glow" id="bg-glow"></div>

    <div id="login-overlay" class="fixed inset-0 z-[9999] flex bg-black transition-opacity duration-700">
        <div class="w-full lg:w-[500px] h-full flex flex-col justify-center px-16 bg-black border-r border-white/5 z-10">
            <div class="reveal visible">
                <div class="earth-container"></div>
                <h1 class="text-3xl font-black tracking-tighter mb-2">Internal Access</h1>
                <p class="text-[10px] text-zinc-600 font-bold uppercase tracking-[0.3em] mb-10">System Gateway v2.5</p>
                
                <div class="space-y-4">
                    <input type="text" id="user-input" placeholder="STAFF_ID" class="w-full bg-white/5 border border-white/10 rounded-xl p-4 text-xs focus:border-blue-500 outline-none text-white transition-all">
                    <input type="password" id="pass-input" placeholder="SECURITY_KEY" class="w-full bg-white/5 border border-white/10 rounded-xl p-4 text-xs focus:border-blue-500 outline-none text-white transition-all">
                    <button onclick="validateLogin()" class="w-full py-4 bg-white text-black rounded-xl text-[10px] font-black uppercase tracking-widest hover:bg-blue-600 hover:text-white transition-all active:scale-95">Authenticate</button>
                </div>
                <p id="login-err" class="text-red-500 text-[9px] mt-4 uppercase font-bold opacity-0 transition-opacity">Access Denied: Invalid Credentials</p>
            </div>
        </div>
        <div class="hidden lg:block flex-1 relative overflow-hidden">
            <div class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=2072')] bg-cover bg-center opacity-30"></div>
            <div class="absolute inset-0 bg-gradient-to-r from-black via-transparent to-transparent"></div>
        </div>
    </div>

    <div id="main-content" class="hidden opacity-0 transition-opacity duration-1000">
        <nav class="fixed top-0 w-full z-50 flex items-center justify-between px-16 py-10 bg-gradient-to-b from-black/50 to-transparent backdrop-blur-sm">
            <span class="text-xs font-black tracking-tighter text-white">TEK INTRA</span>
            <div class="flex items-center gap-10">
                <button onclick="showPage('home')" id="nav-home" class="nav-link active">Home</button>
                <button onclick="showPage('projects')" id="nav-projects" class="nav-link">Projects</button>
                <button onclick="showPage('downloads')" id="nav-downloads" class="nav-link">Resources</button>
                <button onclick="logout()" class="text-[9px] font-bold text-red-500 hover:text-red-400 uppercase tracking-widest transition-colors">Log Out</button>
            </div>
        </nav>

         <main id="page-home" class="page-view active-view pt-64 px-12 max-w-7xl mx-auto pb-20">
    <div class="flex flex-col lg:flex-row gap-24 items-start mb-32">
        <div class="lg:w-5/12 reveal">
            <h1 class="text-[120px] leading-[0.8] font-black tracking-tighter mb-6">TEK<br><span class="text-zinc-800">Intra</span></h1>
            <p class="text-xl text-zinc-500 mb-10 font-light">The ultimate all-in-one staff nexus.</p>
        </div>
        <div class="lg:w-7/12">
            <p class="text-[10px] font-bold mb-10 tracking-[0.3em] text-zinc-600 uppercase">About TEK INTRA</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                <div class="sirius-card p-8 rounded-[35px] reveal">
                    <h4 class="font-bold text-sm mb-3">All-in-one</h4>
                    <p class="text-[11px] text-zinc-500">TEK INTRA centralizes everything you need in one place.</p>
                </div>
                <div class="sirius-card p-8 rounded-[35px] reveal">
                    <h4 class="font-bold text-sm mb-3">Downloads</h4>
                    <p class="text-[11px] text-zinc-500">Access all essential development assets for TEK Studios.</p>
                </div>
                <div class="sirius-card p-8 rounded-[35px] reveal">
                    <h4 class="font-bold text-sm mb-3">Overview</h4>
                    <p class="text-[11px] text-zinc-500">Get a comprehensive high-level view of TEK Studios' operations.</p>
                </div>
                <div class="sirius-card p-8 rounded-[35px] reveal">
                    <h4 class="font-bold text-sm mb-3">Precision Design</h4>
                    <p class="text-[11px] text-zinc-500">Tailored specifically to optimize the TEK Studios development workflow.</p>
                </div>
            </div>
        </div>
    </div>
    
    <h3 class="text-[10px] font-bold mb-10 tracking-[0.3em] text-zinc-600 uppercase reveal">Latest news</h3>
    <div id="news-grid" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
</main>

        <main id="page-projects" class="page-view pt-48 px-16 max-w-7xl mx-auto pb-20">
            <h2 class="text-4xl font-black mb-12 tracking-tighter">Active Projects</h2>
            <div id="game-grid" class="grid grid-cols-1 md:grid-cols-4 gap-6"></div>
        </main>

        <main id="page-downloads" class="page-view pt-48 px-16 max-w-7xl mx-auto pb-20">
            <h2 class="text-4xl font-black mb-12 tracking-tighter">Resources</h2>
            <div id="downloads-grid" class="grid grid-cols-1 md:grid-cols-3 gap-4"></div>
        </main>
    </div>

    <div id="project-modal" class="fixed inset-0 z-[10000] hidden flex items-center justify-center p-6 opacity-0 transition-all duration-500">
        <div class="absolute inset-0 bg-black/90 backdrop-blur-2xl" onclick="closeModal()"></div>
        <div class="relative bg-zinc-950 border border-white/10 w-full max-w-3xl rounded-[40px] overflow-hidden flex flex-col md:flex-row shadow-2xl">
            <div class="md:w-1/2 h-64 md:h-auto"><img id="modal-img" src="" class="w-full h-full object-cover"></div>
            <div class="md:w-1/2 p-12 flex flex-col justify-center">
                <div class="flex items-center gap-3 mb-6">
                    <div id="modal-status-dot" class="w-2.5 h-2.5 rounded-full animate-pulse"></div>
                    <span id="modal-status-text" class="text-[10px] font-bold uppercase tracking-widest text-zinc-400"></span>
                </div>
                <h2 id="modal-title" class="text-4xl font-black tracking-tighter mb-4"></h2>
                <p id="modal-desc" class="text-zinc-500 text-sm leading-relaxed mb-10"></p>
                <a id="modal-link" href="#" target="_blank" class="text-center py-4 bg-white text-black rounded-xl text-[10px] font-black uppercase tracking-widest hover:bg-blue-600 hover:text-white transition-all">Launch Console</a>
            </div>
        </div>
    </div>

    <script>
    let cachedGames = [];
    const statusMap = { 
        operational: { color: "#4ade80", label: "Operational" }, 
        maintenance: { color: "#fbbf24", label: "Maintenance" }, 
        offline: { color: "#ef4444", label: "Offline" } 
    };

    // --- AUTHENTICATION ---
    function validateLogin() {
        const user = document.getElementById('user-input').value;
        const pass = document.getElementById('pass-input').value;
        const err = document.getElementById('login-err');

        // Simple validation - logic remains the same
        if(user.length > 2 && pass.length > 3) {
            // FIX 1: Always set path to '/'
            Cookies.set('tek_session', 'active_staff_verified', { expires: 7, path: '/' });
            revealUI();
        } else {
            err.style.opacity = '1';
            setTimeout(() => err.style.opacity = '0', 3000);
        }
    }

    function logout() { 
        // FIX 2: Match the path exactly when removing
        Cookies.remove('tek_session', { path: '/' }); 
        
        // Clear session storage just in case
        sessionStorage.clear();

        // FIX 3: Instead of reload(), redirect to the base URL to wipe the state
        window.location.href = window.location.pathname;
    }

    function revealUI() {
        const overlay = document.getElementById('login-overlay');
        const main = document.getElementById('main-content');
        
        overlay.style.opacity = '0';
        setTimeout(() => {
            overlay.style.display = 'none';
            main.classList.remove('hidden');
            setTimeout(() => {
                main.style.opacity = '1';
                loadAllData();
            }, 50);
        }, 700);
    }

    // --- PAGE INITIALIZATION ---
    window.onload = () => { 
        const session = Cookies.get('tek_session');
        
        if (session === 'active_staff_verified') {
            revealUI(); 
        } else {
            // FIX 4: Ensure the UI is strictly in "Login Mode" if no cookie exists
            document.getElementById('login-overlay').style.display = 'flex';
            document.getElementById('login-overlay').style.opacity = '1';
            document.getElementById('main-content').classList.add('hidden');
        }
    };

async function loadAllData() {
  const mock = {
    news: [{ title: "System Online", content: "V2.5 Gateway successfully deployed.", date: "02.08.2026" }],
    projects: [{ title: "Project Sirius", status: "operational", imageurl: "...", description: "Telemetry engine." }],
    downloads: [{ name: "Staff SDK", url: "#", version: "v4.2.0" }]
  };

  try {
    // Wir fragen DEINEN Express-Server ab, nicht direkt Supabase
    const [newsRes, projectsRes, downloadsRes] = await Promise.all([
      fetch('/api/news'),
      fetch('/api/projects'),
      fetch('/api/downloads')
    ]);

    // Daten aus den Responses extrahieren
    const news = await newsRes.json();
    const projects = await projectsRes.json();
    const downloads = await downloadsRes.json();

    // Falls der Server leere Arrays oder Fehler schickt, Mock-Daten als Backup
    renderData(
      news.length ? news : mock.news,
      projects.length ? projects : mock.projects,
      downloads.length ? downloads : mock.downloads
    );

  } catch (e) {
    console.warn("Server nicht erreichbar oder Fehler, nutze Mock-Daten", e);
    renderData(mock.news, mock.projects, mock.downloads);
  }

  // Falls vorhanden, Animationen triggern
  if (typeof triggerAnimations === "function") {
    triggerAnimations();
  }
}


    function renderData(news, games, downloads) {
        document.getElementById('news-grid').innerHTML = news.map(n => `
            <div class="sirius-card p-10 rounded-[35px] reveal">
                <span class="text-[9px] font-mono text-zinc-600 uppercase tracking-widest">${n.date}</span>
                <h4 class="font-bold text-lg mt-3 mb-4 tracking-tight uppercase">${n.title}</h4>
                <p class="text-[11px] text-zinc-500 leading-relaxed">${n.content || n.description}</p>
            </div>`).join('');

        document.getElementById('game-grid').innerHTML = games.map((g, i) => {
            const config = statusMap[(g.status || "offline").toLowerCase()] || statusMap.offline;
            return `
            <div onclick="openModal(${i})" class="sirius-card p-6 rounded-[30px] cursor-pointer group reveal">
                <div class="h-44 bg-zinc-900 rounded-[22px] overflow-hidden mb-6">
                    <img src="${g.imageurl}" class="w-full h-full object-cover grayscale opacity-40 group-hover:grayscale-0 group-hover:opacity-100 group-hover:scale-110 transition-all duration-700">
                </div>
                <h4 class="font-bold text-sm px-2 mb-1">${g.title}</h4>
                <div class="flex items-center gap-2 px-2 mt-2">
                    <div class="w-1.5 h-1.5 rounded-full" style="background-color: ${config.color}"></div>
                    <span class="text-[9px] font-bold uppercase tracking-widest" style="color: ${config.color}">${config.label}</span>
                </div>
            </div>`;
        }).join('');

        document.getElementById('downloads-grid').innerHTML = downloads.map(d => `
            <div class="sirius-card p-6 rounded-[25px] flex items-center justify-between reveal">
                <div class="flex items-center gap-4">
                    <div class="w-10 h-10 rounded-xl bg-white/5 flex items-center justify-center text-zinc-400">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M4 16v1a2 2 0 002 2h12a2 2 0 002-2v-1M7 10l5 5m0 0l5-5m-5 5V3"/></svg>
                    </div>
                    <div><h4 class="font-bold text-xs text-zinc-300">${d.name}</h4><p class="text-[9px] text-zinc-600 font-mono mt-0.5">${d.version || 'v1.0'}</p></div>
                </div>
                <a href="${d.url}" download class="bg-white text-black text-[9px] font-black px-5 py-2.5 rounded-xl uppercase hover:bg-blue-600 hover:text-white transition-all">Download</a>
            </div>`).join('');
    }

    function showPage(id) {
        const currentView = document.querySelector('.page-view.active-view');
        const nextView = document.getElementById('page-' + id);
        if (currentView.id === 'page-' + id) return;
        currentView.classList.add('view-exit');
        setTimeout(() => {
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            document.getElementById('nav-' + id).classList.add('active');
            document.querySelectorAll('.page-view').forEach(p => p.classList.remove('active-view', 'view-exit'));
            nextView.classList.add('active-view');
            setTimeout(() => triggerAnimations(), 50);
        }, 500);
    }

    function triggerAnimations() {
        document.querySelectorAll('.active-view .reveal').forEach((el, i) => {
            setTimeout(() => el.classList.add('visible'), i * 80);
        });
    }

    function openModal(index) {
        const g = cachedGames[index];
        const config = statusMap[(g.status || "offline").toLowerCase()] || statusMap.offline;
        document.getElementById('modal-img').src = g.imageurl;
        document.getElementById('modal-title').innerText = g.title;
        document.getElementById('modal-desc').innerText = g.description || "Restricted access.";
        document.getElementById('modal-status-dot').style.backgroundColor = config.color;
        document.getElementById('modal-status-text').innerText = config.label;
        const modal = document.getElementById('project-modal');
        modal.classList.remove('hidden');
        setTimeout(() => modal.style.opacity = '1', 10);
    }

    function closeModal() {
        const modal = document.getElementById('project-modal');
        modal.style.opacity = '0';
        setTimeout(() => modal.classList.add('hidden'), 500);
    }
</script>
</body>
</html>