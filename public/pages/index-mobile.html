<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
    <title>TEK Intra | Staff Network</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js"></script>
    <style>
        :root { --bg-dark: #000000; --accent: #3b82f6; }
        
        body {
            background: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.8)), 
                        url('https://cdn.discordapp.com/attachments/1051507841447501886/1472916682501521534/image-14.png?ex=6994500e&is=6992fe8e&hm=b47c8ac2a46baa5e6f331a8e876a7d25e0da8e2417760e441876bcc4b595bbe5&');
            background-size: cover; background-position: center; background-attachment: fixed;
            color: #ffffff; font-family: 'Inter', sans-serif; overflow-x: hidden; min-height: 100vh;
        }

        .page-view {
            position: absolute; width: 100%; top: 0; left: 0;
            display: none; opacity: 0; transform: translateY(10px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        .active-view { display: block; opacity: 1; transform: translateY(0); z-index: 5; }
        .view-exit { opacity: 0 !important; transform: translateY(-10px); pointer-events: none; }

        .reveal {
            opacity: 0; transform: translateY(20px);
            transition: opacity 0.6s cubic-bezier(0.23, 1, 0.32, 1), transform 0.6s cubic-bezier(0.23, 1, 0.32, 1);
        }
        .reveal.visible { opacity: 1; transform: translateY(0); }

        .nav-link { position: relative; font-size: 0.6rem; color: #71717a; font-weight: 800; text-transform: uppercase; letter-spacing: 0.1em; transition: 0.3s; }
        .nav-link.active, .nav-link:hover { color: #fff; }
        .nav-link::after {
            content: ''; position: absolute; bottom: -8px; left: 50%; width: 0%; height: 2px;
            background: #3b82f6; transition: 0.4s; transform: translateX(-50%);
        }
        .nav-link.active::after { width: 100%; }

        .sirius-card { 
            background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(15px); 
            border: 1px solid rgba(255, 255, 255, 0.08); transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .sirius-card:active { transform: scale(0.98); background: rgba(255, 255, 255, 0.06); }

        .earth-container {
            width: 44px; height: 44px; border-radius: 50%; overflow: hidden;
            box-shadow: inset -5px -5px 15px rgba(0,0,0,0.8), 0 0 20px rgba(59, 130, 246, 0.3);
            background: url('https://upload.wikimedia.org/wikipedia/commons/thumb/c/c4/Earth_map_light_600x300.jpg/600px-Earth_map_light_600x300.jpg');
            background-size: cover; animation: rotateEarth 20s linear infinite; margin-bottom: 1.5rem;
        }
        @keyframes rotateEarth { from { background-position: 0 0; } to { background-position: 200% 0; } }
        ::-webkit-scrollbar { width: 0px; }
        
        /* Mobile Specific Overrides */
        @media (max-width: 768px) {
            .nav-link { font-size: 0.55rem; letter-spacing: 0.05em; }
            .hero-title { font-size: 3.5rem !important; line-height: 0.9; }
        }
    </style>
</head>
<body>

    <div id="login-overlay" class="fixed inset-0 z-[9999] flex bg-black transition-opacity duration-700">
        <div class="w-full lg:w-[500px] h-full flex flex-col justify-center px-8 sm:px-16 bg-black border-r border-white/5 z-10">
            <div class="reveal visible">
                <div class="earth-container"></div>
                <h1 class="text-3xl font-black tracking-tighter mb-1 uppercase">Tek Intra</h1>
                <p class="text-zinc-500 text-[9px] mb-8 tracking-widest uppercase">Mobile Access Node</p>
                <div class="space-y-3">
                    <input type="text" id="user-input" placeholder="STAFF_ID" class="w-full bg-white/5 border border-white/10 rounded-xl p-4 text-xs focus:border-blue-500 outline-none text-white transition-all">
                    <input type="password" id="pass-input" placeholder="SECURITY_KEY" class="w-full bg-white/5 border border-white/10 rounded-xl p-4 text-xs focus:border-blue-500 outline-none text-white transition-all">
                    <button id="auth-btn" onclick="validateLogin()" class="w-full py-4 bg-white text-black rounded-xl text-[10px] font-black uppercase tracking-widest active:bg-blue-600 active:text-white transition-all active:scale-95">Authenticate</button>
                </div>
                <p id="login-err" class="text-red-500 text-[9px] mt-4 uppercase font-bold opacity-0 transition-opacity text-center">Access Denied</p>
            </div>
        </div>
        <div class="hidden lg:block flex-1 relative opacity-30">
            <div class="absolute inset-0 bg-[url('https://cdn.discordapp.com/attachments/1051507841447501886/1472916682501521534/image-14.png?ex=6994500e&is=6992fe8e&hm=b47c8ac2a46baa5e6f331a8e876a7d25e0da8e2417760e441876bcc4b595bbe5&')] bg-cover bg-center"></div>
        </div>
    </div>

    <div id="main-content" class="hidden opacity-0 transition-opacity duration-1000">
        <nav class="fixed top-4 left-1/2 -translate-x-1/2 w-[94%] max-w-5xl z-[100] flex items-center justify-between px-4 sm:px-8 py-3 bg-black/60 backdrop-blur-2xl border border-white/10 rounded-2xl sm:rounded-full">
            <span class="text-[10px] font-black tracking-tighter text-white flex items-center gap-2">
                <div class="w-1.5 h-1.5 bg-blue-500 rounded-full animate-pulse"></div> TEK
            </span>
            <div class="flex items-center gap-4 sm:gap-8">
                <button onclick="showPage('home')" id="nav-home" class="nav-link active">Home</button>
                <button onclick="showPage('projects')" id="nav-projects" class="nav-link">Games</button>
                <button onclick="showPage('downloads')" id="nav-downloads" class="nav-link">Assets</button>
                <button onclick="logout()" class="text-[9px] font-bold text-red-500 uppercase tracking-widest ml-1">Exit</button>
            </div>
        </nav>

        <main id="page-home" class="page-view active-view pt-28 sm:pt-32 px-6 lg:px-16 max-w-7xl mx-auto pb-20">
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 lg:gap-12">
                <div class="lg:col-span-7">
                    <div class="mb-8 sm:mb-12 reveal">
                        <h3 id="welcome-user" class="text-blue-500 text-[10px] font-black uppercase tracking-[0.3em] mb-4">Welcome back, Agent</h3>
                        <h1 class="hero-title text-5xl lg:text-8xl font-black tracking-tighter text-white mb-6 leading-tight">TEK Studios <br><span class="text-zinc-600">INTRA</span></h1>
                        <p class="text-zinc-400 text-sm sm:text-lg max-w-md leading-relaxed border-l-2 border-blue-500 pl-4 sm:pl-6">Next generation hub for TEK personnel.</p>
                    </div>
                    
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-3 sm:gap-4 mb-12">
                        <div class="sirius-card p-4 sm:p-6 rounded-2xl reveal">
                            <p class="text-[8px] text-zinc-500 uppercase font-bold mb-1">Latency</p>
                            <p id="stat-latency" class="text-lg sm:text-xl font-black text-blue-500">--ms</p>
                        </div>
                        <div class="sirius-card p-4 sm:p-6 rounded-2xl reveal">
                            <p class="text-[8px] text-zinc-500 uppercase font-bold mb-1">Projects</p>
                            <p id="stat-projects" class="text-lg sm:text-xl font-black text-white">0</p>
                        </div>
                        <div class="sirius-card p-4 sm:p-6 rounded-2xl reveal col-span-2 md:col-span-1">
                            <p class="text-[8px] text-zinc-500 uppercase font-bold mb-1">User ID</p>
                            <p id="stat-user-identity" class="text-lg sm:text-xl font-black text-green-500 uppercase truncate">Guest</p>
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-5">
                    <h2 class="text-[10px] font-black uppercase tracking-widest text-zinc-500 mb-6 flex items-center gap-4">
                        <span class="w-8 h-[1px] bg-zinc-800"></span> Updates
                    </h2>
                    <div id="news-grid" class="space-y-4"></div>
                </div>
            </div>
        </main>

        <main id="page-projects" class="page-view pt-28 px-6 lg:px-16 max-w-7xl mx-auto pb-20">
            <h2 class="text-3xl sm:text-5xl font-black mb-8 tracking-tighter reveal">INTRA <span class="text-blue-500">| GAMES</span></h2>
            <div id="game-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4"></div>
        </main>

        <main id="page-downloads" class="page-view pt-28 px-6 lg:px-16 max-w-7xl mx-auto pb-20">
            <h2 class="text-3xl sm:text-5xl font-black mb-8 tracking-tighter reveal">INTRA <span class="text-blue-500">| ASSETS</span></h2>
            <div id="downloads-grid" class="grid grid-cols-1 md:grid-cols-3 gap-3"></div>
        </main>
    </div>

    <script>
        const statusMap = { operational: { color: "#4ade80", label: "Online" }, maintenance: { color: "#fbbf24", label: "Maint" }, offline: { color: "#ef4444", label: "Offline" } };

        async function validateLogin() {
            const username = document.getElementById('user-input').value.trim();
            const password = document.getElementById('pass-input').value.trim();
            const btn = document.getElementById('auth-btn');
            if (!username || !password) return showError("Input Required");
            btn.innerText = "VERIFYING..."; btn.disabled = true;
            try {
                const res = await fetch('/api/login', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ username, password }) });
                const data = await res.json();
                if (data.success) {
                    localStorage.setItem('tek_user', data.user.username);
                    Cookies.set('tek_session', 'verified', { expires: 1 });
                    revealUI();
                } else showError(data.message || "Invalid Credentials");
            } catch (e) { showError("Server Error"); } finally { btn.innerText = "Authenticate"; btn.disabled = false; }
        }

        function showError(msg) {
            const err = document.getElementById('login-err');
            err.innerText = msg.toUpperCase(); err.style.opacity = '1';
            setTimeout(() => err.style.opacity = '0', 3000);
        }

        function revealUI() {
            const overlay = document.getElementById('login-overlay');
            const main = document.getElementById('main-content');
            const activeUser = localStorage.getItem('tek_user') || 'Staff';
            
            document.getElementById('welcome-user').innerText = `Welcome back, ${activeUser}`;
            document.getElementById('stat-user-identity').innerText = activeUser;
            
            overlay.classList.add('view-exit');
            setTimeout(() => {
                overlay.style.display = 'none';
                main.classList.remove('hidden');
                setTimeout(() => { 
                    main.style.opacity = '1'; 
                    loadData(); 
                    startPinger(); 
                }, 50);
            }, 600);
        }

        function logout() { Cookies.remove('tek_session'); localStorage.clear(); window.location.reload(); }

        function startPinger() {
            setInterval(async () => {
                const start = Date.now();
                try {
                    await fetch('/api/news', { method: 'HEAD' });
                    const duration = Date.now() - start;
                    document.getElementById('stat-latency').innerText = `${duration}ms`;
                } catch (e) {
                    document.getElementById('stat-latency').innerText = `ERR`;
                }
            }, 5000);
        }

        async function loadData() {
            try {
                const [news, projs, dls] = await Promise.all([
                    fetch('/api/news').then(r => r.json()).catch(() => []),
                    fetch('/api/projects').then(r => r.json()).catch(() => []),
                    fetch('/api/downloads').then(r => r.json()).catch(() => [])
                ]);
                document.getElementById('stat-projects').innerText = projs.length;
                render(news, projs, dls);
                triggerAnims();
            } catch (e) { triggerAnims(); }
        }

        function render(news, games, dls) {
            document.getElementById('news-grid').innerHTML = news.map(n => `
                <div class="sirius-card p-5 rounded-2xl reveal">
                    <span class="text-[7px] font-black text-blue-500 uppercase tracking-[0.2em] mb-2 block">${new Date(n.created_at).toLocaleDateString()}</span>
                    <h4 class="font-bold text-xs mb-2 uppercase">${n.title}</h4>
                    <p class="text-[10px] text-zinc-500 leading-relaxed">${n.content || ''}</p>
                </div>`).join('');

            document.getElementById('game-grid').innerHTML = games.map(g => {
                const s = statusMap[g.status?.toLowerCase()] || statusMap.offline;
                return `
                <div class="sirius-card p-4 rounded-[20px] reveal group">
                    <div class="h-28 bg-zinc-900 rounded-xl overflow-hidden mb-3 relative">
                        <img src="${g.imageurl}" class="w-full h-full object-cover opacity-60">
                    </div>
                    <h4 class="font-bold text-[10px] mb-2 uppercase tracking-tight">${g.title}</h4>
                    <div class="flex items-center gap-2">
                        <div class="w-1 h-1 rounded-full" style="background-color:${s.color}"></div>
                        <span class="text-[7px] font-black uppercase" style="color:${s.color}">${s.label}</span>
                    </div>
                </div>`;
            }).join('');

            document.getElementById('downloads-grid').innerHTML = dls.map(d => `
                <div class="sirius-card p-5 rounded-xl flex items-center justify-between reveal">
                    <div>
                        <h4 class="font-bold text-[9px] text-zinc-300 uppercase">${d.name}</h4>
                        <p class="text-[7px] text-zinc-600 font-mono">${d.version || 'STABLE'}</p>
                    </div>
                    <a href="${d.url}" class="bg-white text-black text-[8px] font-black px-3 py-2 rounded-lg uppercase active:bg-blue-600 active:text-white transition-all">Get</a>
                </div>`).join('');
        }

        function showPage(id) {
            const current = document.querySelector('.page-view.active-view');
            const target = document.getElementById('page-' + id);
            if (!current || current.id === target.id) return;
            document.querySelectorAll('.nav-link').forEach(n => n.classList.toggle('active', n.id === 'nav-' + id));
            target.querySelectorAll('.reveal').forEach(el => el.classList.remove('visible'));
            current.classList.add('view-exit');
            setTimeout(() => {
                current.classList.remove('active-view', 'view-exit');
                target.classList.add('active-view');
                window.scrollTo(0,0);
                setTimeout(triggerAnims, 50);
            }, 400);
        }

        function triggerAnims() {
            const activePage = document.querySelector('.page-view.active-view');
            if (!activePage) return;
            const elements = activePage.querySelectorAll('.reveal');
            elements.forEach((el, i) => {
                setTimeout(() => { el.classList.add('visible'); }, i * 60); 
            });
        }

        window.onload = () => { if (Cookies.get('tek_session')) revealUI(); };
        document.addEventListener('keypress', e => { if(e.key === 'Enter') validateLogin(); });
    </script>
</body>
</html>